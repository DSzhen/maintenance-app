<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
		<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
		<link rel="stylesheet" type="text/css" href="../../css/api.css" />
		<link rel="stylesheet" type="text/css" href="../../css/aui.css" />
		<link rel="stylesheet" type="text/css" href="../../css/MintUistyle.css" />
		<link rel="stylesheet" type="text/css" href="../../css/wbicon/style.css" />
		<link rel="stylesheet" type="text/css" href="../../css/mobileSelect.css" />
		<link rel="stylesheet" href="../../css/mint-ui.css" />
		<style type="text/css">
			body,html {
				background-color: #f6f6f6;
				height: 100%;
				width: 100%;
			}

			.wb-flex {
				display: -webkit-box;
				display: -webkit-flex;
				display: flex;
				-webkit-box-pack: justify;
				-webkit-justify-content: center;
				justify-content: center;
				-webkit-box-align: center;
				-webkit-align-items: center;
				align-items: center;
			}

			.wb-space-between {
				-webkit-justify-content: space-between;
				justify-content: space-between;
			}

			.aui-btn-warning.wb-time-btn {
				width: 6rem;
				background-color: rgba(255, 150, 27, .8) !important;
				border-radius: .7rem;
			}

			.wb-time-btn input {
				width: 100%;
				height: 1.5rem;
				padding-left: 0.2rem;
				line-height: 1.55rem;
				color: #fff;
				font-size: .9rem;
			}

			.wb-margin-t-10 {
				margin-top: 1rem;
			}

			.aui-content-padded {
				margin: .5rem;
			}

			.aui-card-list {
				margin-bottom: .5rem;
				/*box-shadow: 0 4px 8px 0 rgba(229, 229, 229, .65);*/
				border-radius: .2rem;
				width: 100%;
			}

			.wb-title-h5 {
				color: #303030;
				font-size: .75rem;
				border-bottom: 1px solid #e6e4e3;
			}

			.wb-telphone {
				display: inline-block;
				line-height: .8rem;
				border-bottom: 1px solid #7d7d85;
				color: #7d7d85;
			}

			.wb-info-des {
				font-size: .75rem;
				color: #a0a0a0;
				height: 1rem;
			}

			.wb-info-des b {
				margin-right: .3rem;
			}

			.mint-button.mint-button--default.mint-button--normal {
				height: 1.5rem;
				padding: 0 1rem;
				font-size: .9rem;
				line-height: 1.6rem;
				color: #fff !important;
				background-color: #ff961b !important;
				border: 0;
				border-radius: .7rem;
				box-shadow: none;
			}

			.wb-margin-t-4 {
				margin-top: .4rem;
			}

			.wb-list-inner {
				max-width: 100%;
			}

			.wb-list-inner p {
				color: #303030;
				width: 100%;
			}

			.wb-list-inner h5 {
				width: 100%;
			}

			.aui-btn-info.aui-btn-outlined.wb-btn {
				color: #0769fc !important;
				background-color: #ecf6ff !important;
				border: 1px solid rgba(7, 105, 252, .6) !important;
			}

			.picker-items .picker-slot:nth-child(3) {
				width: 0 !important;
				flex: none !important;
			}

			.picker-item {
				color: #707070;
				font-size: .9rem;
			}

			.picker-center-highlight {
				background-color: #fff2e2;
				border: 0;
				z-index: -1;
			}

			.selector {
				background: #FF961B;
				box-shadow: 1px 2px 20px 2px #000000;
				width: 544px;
				height: 122px;
			}

			.mint-datetime-action {
				height: 2.4rem;
				line-height: 2.4rem;
				font-size: .9rem;
				color: #333;
			}

			.picker-toolbar .mint-datetime-action:last-child,
			.mint-datetime-action:hover,
			.mint-datetime-action:focus {
				background-color: #ff961b;
				color: #fff;
			}

			.picker.mint-datetime-picker {
				position: relative;
			}

			.picker-toolbar {
				height: 2.4rem;
				position: absolute;
				bottom: 0;
				left: 0;
				right: 0;
				width: 100%;
				background-color: #fff;
				box-shadow: 0 -2px 15px 1px rgba(0, 0, 0, .05);
				z-index: 50;
			}

			.wb-card-mark {
				position: absolute;
				top: 0rem;
				right: 0;
			}

			[v-cloak] {
				display: none;
			}

			.defaultDiv-layout {
				margin-top: 35%;
				height: 100%;
				width: 100%;
				text-align: center;
			}

			.defaultDiv-layout label {
				color: #C4C4C4;
			}

			.defaultDiv {
				display: flex;
				justify-content: center;
				align-items: center;
				margin-bottom: 1rem;
			}

			.defaultDiv img {
				height: 5.5rem;
				width: 6rem;
			}

			.aui-card-list-header {
				position: relative;
				border-bottom: 1px solid #e6e4e3;
				border-top-left-radius: 3px;
				border-top-right-radius: 3px;
			}

			.wbicon {
				color: #828285;
			}

			.wb-card-list-header {
				display: flex;
				justify-content: center;
				align-items: center;
			}

			.wbicon-building {
				padding-right: .2rem;
			}

			.wb-standard-img {
				position: absolute;
				top: 0;
				right: 0;
			}

			.wb-standard-img img {
				/*width:1.86rem;*/
				height: .8rem;
			}

			.wb-planType {
				display: inline-block;
				height: .73rem;
				width: .73rem;
				margin-bottom: -.1rem;
				margin-right:.16rem;
			}
			.filter {
				position: fixed;
				top: -.5rem;
				right: 3rem;
				z-index: 10000;
			}

			.signAndReport {
				position: absolute;
				width: 4rem;
				height: 1.53rem;
				border: 1px solid #ff961b;
				border-radius: .76rem;
				line-height: 1.53rem;
				text-align: center;
				color: #ff961b;
				right: .8rem;
				top: 2.9rem;
			}
			.wb-telephoneCon{
				display: flex;
				justify-content: flex-start;
				align-items: center;
			}
			.wb-bulid{
				width:.63rem;
				height:.73rem;
				display: inline-block;
				margin-right: .2rem;
			}
		</style>
	</head>

	<body>
		<section class="aui-content" id="app" v-cloak>
			<!--<div class="filter"><b class="wbicon-filtrate"></b></div>-->
			<div class="aui-content-padded" v-if="completedData.length > 0">
				<div class="aui-card-list" v-for="item in completedData" @click.stop="clickItem(item)">
					<div class="aui-card-list-header">
						<h3 class="aui-ellipsis-1 wb-card-list-header aui-margin-r-5" style="font-size: .75rem;color:#303030;"><img class="wb-bulid" src="../../image/routine/bulid.png" alt="" />{{item.proprietorName}}</h3>
						<a v-if="item.normal != ''" class="wb-standard-img"><img :src="nonstandard[item.normal]" alt="" /></a>
					</div>
					<div class="aui-card-list-content-padded aui-padded-b-15 wb-flex wb-space-between">
						<div class="wb-list-inner">
							<p class="wb-info-des wb-margin-t-4 aui-ellipsis-1">
								<a class="wb-planType"><img :src="planTypeImg[item.planType-1]" alt="" /></a>
								</b> {{item.planName}}</p>
							<p class="wb-info-des wb-margin-t-4 aui-ellipsis-1"><b class="wbicon-linkMan wbicon"></b>{{item.contacts}}

							</p>
							<p class="wb-info-des wb-margin-t-4 aui-ellipsis-1 wb-telephoneCon"><b class="wbicon-phone wbicon"></b>
								<a class="wb-telphone" @click="callPhone($event,item.contactsTel)">{{item.contactsTel}}</a>
							</p>
						</div>
						<div class="signAndReport" v-if="item.signBase64 == '0'" @click.stop="ownerSignature(item)">业主签字</div>

						<div class="signAndReport" v-if="item.signBase64 == '1'" @click.stop="ownerSignature(item)">查看报告</div>
						<!--<div :class=item.classes>{{item.completedText}}</div>
						<div class="wb-card-mark" v-if="item.isOverdue ==1"><img src="../image/wb-mark.png" style="width: 2.2rem"></div>-->
					</div>
				</div>
				<div class='noshuju' style="text-align:center;color:#999999; display:none">没有数据啦</div>
				<div class='to_load' style="text-align:center;color:#999999;display:none">加载更多...</div>
			</div>
			<div class="routineDefaultImg" v-if="defaultDiv != ''">
				<div class='defaultDiv-layout'>
					<div class='defaultDiv'><img :src='defaultDiv' /></div>
					<label style="">暂无例行维保任务，快联系管理员制定吧</label>
				</div>
			</div>
		</section>
	</body>
	<script type="text/javascript" src="../../script/api.js"></script>
	<script type="text/javascript" src="../../config/config.js"></script>
	<script type="text/javascript" src="../../script/vue.js"></script>
	<script type="text/javascript" src="../../script/mint-ui.js"></script>
	<script type="text/javascript" src="../../script/zepto.js"></script>
	<script type="text/javascript" src="../../script/mobileSelect.js"></script>
	<script type="text/javascript" src="../../script/umeng/zhuge.js"></script>

	<script type="text/javascript">
		//����һ��������ֹ�ظ�����ajax
		var preventAjaxRepeatSubmit = true;
		var pageNo = 2;
		var pageVue;
		var paramObj = JSON.parse(localStorage.getItem('userObj'));
		var UIDatePicker;
		apiready = function() {
			UIDatePicker = api.require('UIDatePicker');
			apiEvents();
			pageVue = new Vue({
				el: '#app',
				data: function() {
					return {
						isSign: '',
						isNormal: "",
						completedData: [],
						pageSize: 10,
						pageNo: 1,
						defaultDiv: "",
						nonstandard: ["../../image/routine/normative.png", "../../image/routine/nonstandard.png"],
						planTypeImg: ["../../image/routine/day.png", "../../image/routine/weeks.png", "../../image/routine/months.png", "../../image/routine/season.png", "../../image/routine/year.png", "../../image/routine/custom.png"]
					}
				},
				created: function() {
					this.initData()
				},
				methods: {
					//
					callPhone: function(e, tel) {
						e.stopPropagation()

						//GrowingIO 埋点 在例行维保列表，用户点击了拨打电话
	
	api.call({
		type: 'tel_prompt',
		number: tel
	});
					},
					// 业主签字 查看报告
					ownerSignature(item) {        
						//GrowingIO 埋点 在例行维保已完成列表，点击了查看报告或者业主签名
						api.openWin({                            
							name: 'lookPdf',
							url: './lookPdf.html',
							bounces: false,
							pageParam: item                        
						});                    
					},
					//
					clickItem: function(item) {
						//例行维保点击进详情
						var groingObj={
							planId_var:item.planId,
							planType_var:'',
							planState_var:'已完成'
						}
						if(item.planType=='1'){
							groingObj.planType_var='日计划'
						}else if(item.planType=='2'){
							groingObj.planType_var='周计划'
						}else if(item.planType=='3'){
							groingObj.planType_var='月计划'
						}else if(item.planType=='4'){
							groingObj.planType_var='季计划'
						}else if(item.planType=='5'){
							groingObj.planType_var='年计划'
						}else if(item.planType=='6'){
							groingObj.planType_var='自定义计划'
						}
						//点击例行维保进详情时触发
						growingIoAddEvent('enterRoutingMaintenanceDetailsPage',groingObj);
						item.planStatus = "3"
						api.openWin({
							name: 'routineMaintenanceDetails',
							url: './_routineMaintenanceDetails.html',
							bounces: false,
							pageParam: item
						})
					},
					initData: function() {
						if(preventAjaxRepeatSubmit) {
							preventAjaxRepeatSubmit = false;
							this.ajaxFun("first")
						}
					},
					ajaxFun: function(str) {
						Vue.$indicator.open("加载中...");
						var that = this,
							pageNo = this.pageNo;
						//�����̨
						var obj = JSON.parse(localStorage.getItem("userObj"));
						api.ajax({
							url: webapp_global.url + "/maintenancePlanProcess/getFinishedPlanList",
							method: 'get',
							dataType: "json",
							data: {
								values: {
									userId: obj.userid,
									isNormal: that.isNormal,
									isSign: that.isSign,
									pageNo: pageNo,
									pageSize: 10
								}
							}
						}, function(ret, err) {
							Vue.$indicator.close();
							api.refreshHeaderLoadDone();
							api.parseTapmode();
							preventAjaxRepeatSubmit = true;
							if(ret && ret.data) {
								if(str != "first") {
									if(ret.data.rows.length == 0) {
										$(".to_load").hide();
										$(".noshuju").show();
									} else {
										that.completedData = that.completedData.concat(ret.data.rows);
										$(".to_load").show();
										$(".noshuju").hide();
									}
								} else {
									that.completedData = ret.data.rows;
									if(!that.completedData) {
										return
									}
									if(that.completedData.length == 0) {
										that.defaultDiv = "../../image/defaultPage/routine.png";
									} else {
										that.defaultDiv = "";
									}
									if(ret.data.rows.length > 9) {
										setTimeout(function() {
											$(".to_load").show();
										}, 500)
									} else {
										$(".to_load").hide();
									}
								}

							} else {
								var connectionType = api.connectionType;
								if(connectionType == "none") {
									that.defaultDiv = "../../image/defaultPage/detectionNetwork.png"
								}
							}
						})
					}
				}
			})
		};

		function filterConpletedRoutine() {
			api.openFrame({
				name: 'routineFilter',
				url: './routineFilter.html',
				rect: {
					x: 0,
					y: 0,
					w: 'auto',
					h: 'auto'
				},
				animation: {
					type: "movein", //�������ͣ�������ͳ�����
					subType: "from_bottom", //���������ͣ���������ͳ�����
					duration: 100
				},
				pageParam: {
					name: 'routionFilter'
				},
				bounces: false,
				bgColor: 'rgba(9,0,0,0)',
				vScrollBarEnabled: true,
				hScrollBarEnabled: true
			});
		}
		//ɸѡ�������
		function filterConpletedRoutineData(isNormal, isSign) {
			pageVue.isNormal = isNormal;
			pageVue.isSign = isSign;

			pageVue.pageNo = 1;
			pageVue.initData();

			//GrowingIO 埋点 在例行维保列表，点击已完成tab项的筛选，点击确定
			growingIoAddEvent('routingMaintenanceFilter');
		}

		function apiEvents() {
			// ����ˢ�¡����������̨�ӿ�
			api.setRefreshHeaderInfo({
				visible: true,
				bgColor: '#ccc',
				textColor: '#fff',
				textDown: '下拉刷新...',
				textUp: '松开刷新...',
				showTime: true
			}, function(ret, err) {
				pageVue.pageNo = 1;
				pageVue.isSign = ""
				pageVue.isNormal = ""
				$(".to_load").hide()
				$(".noshuju").hide();
				if(preventAjaxRepeatSubmit) {
					preventAjaxRepeatSubmit = false;
					pageVue.ajaxFun('first');
				}

			});

			api.addEventListener({
				name: 'scrolltobottom',
				extra: {
					threshold: 0
				}
			}, function(ret, err) {
				pageVue.pageNo += 1;
				setTimeout(function() {
					pageVue.ajaxFun()
				}, 500)
			});

			var connectionType = api.connectionType;
			if(connectionType == "none") {
				api.toast({
					msg: '网络走丢了，请找回网络',
					duration: 2000,
					location: 'middle',
					global: true
				});
			}
			//�����豸�Ͽ�������¼����ַ�����
			api.addEventListener({
				name: 'offline'
			}, function(ret, err) {
				api.toast({
					msg: '网络走丢了，请找回网络',
					duration: 2000,
					location: 'middle',
					global: true
				});
			});
			//�����豸���ӵ�������¼����ַ�����
			api.addEventListener({
				name: 'online'
			}, function(ret, err) {
				api.toast({
					msg: '网络已经找回，请刷新页面',
					duration: 2000,
					location: 'middle',
					global: true
				});
			});
			api.addEventListener({
				name: 'updatePlanDataPage'
			}, function(ret, err) {
				pageVue.pageNo = 1;
				pageVue.isSign = ""
				pageVue.isNormal = ""
				$(".to_load").hide()
				$(".noshuju").hide();
				if(preventAjaxRepeatSubmit) {
					preventAjaxRepeatSubmit = false;
					pageVue.ajaxFun('first');
				}
			});
			//ios右滑控制
      api.addEventListener({
        name:'swiperight'
      }, function(ret, err){
      });
		}

		function closeWin() {
			api.closeWin({});
		}
	</script>

</html>
