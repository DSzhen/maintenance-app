<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <link rel="stylesheet" type="text/css" href="../../css/api.css" />
   <link rel="stylesheet" type="text/css" href="../../css/aui.css" />
		<link rel="stylesheet" type="text/css" href="../../css/MintUistyle.css" />
		<link rel="stylesheet" type="text/css" href="../../css/wbicon/style.css" />
		<link rel="stylesheet" type="text/css" href="../../css/xficon/style.css" />
		<link rel="stylesheet" type="text/css" href="../../css/mobileSelect.css" />
		<link rel="stylesheet" href="../../css/mint-ui.css" />
		<link rel="stylesheet" href="../../css/suspension.css" />
    <style type="text/css">
        html,body {
				background-color: #f6f6f6;
				height: 100%;
			}

			.wb-flex {
				display: -webkit-box;
				display: -webkit-flex;
				display: flex;
				-webkit-box-pack: justify;
				-webkit-justify-content: center;
				justify-content: center;
				-webkit-box-align: center;
				-webkit-align-items: center;
				align-items: center;
			}

			.wb-space-between {
				-webkit-justify-content: space-between;
				justify-content: space-between;
			}
        .aui-content-padded {
            margin: .5rem 0;
        }
        .aui-card-list {
            margin-bottom: .5rem;
        }

        .wb-flex-start{
            -webkit-justify-content: flex-start;
            justify-content: flex-start;
            /*height:2.33rem;
            line-height: 2.33rem;*/
        }
        .wb-space-between {
            -webkit-justify-content: space-between;
            justify-content: space-between;
        }
        .wb-item-flexStart {
            -webkit-align-items: flex-start;
            align-items: flex-start;
        }
        .aui-card-list-header {
            padding: .3rem .5rem;
            font-size: .75rem;
        }
        .aui-card-list-content-padded {
            padding: 0.5rem 0.5rem;
        }
        .wb-pending-txt {
            color: #333;
            font-size: .75rem;
        }
        .wb-card-list-header {
            max-width: 80%;
            font-size: .75rem;
            color:#ff961b;
        }
        .wb-card-list-header b {
            color: #fd9905;
            margin-left: -.2rem;
            vertical-align: -1px;
            font-weight: bold;
        }
        .wb-text-info {
            margin-left: .8rem;
            color: #0a85ff;
            vertical-align: -3px;
        }
        .wb-card-title {
            color: #303033;
            font-size: .75rem;
            white-space: nowrap;
        }
        .wb-info-text {
            font-size: .75rem;
            color:#828285;
        }
        .aui-card-list-content-padded .wb-flex + .wb-flex {
            margin-top: .7rem;
        }
        .wb-info-text span {
            margin-left: .5rem;
        }
        .wb-hidden-trouble {
            max-width: 80%;
        }
        .wb-hidden-trouble-conduct {
            margin-right: .3rem;
            color: #0a85ff;
            font-size: .72rem;
            white-space: nowrap;
        }
        .wb-hidden-trouble-conduct b {
            color: #bcbcbc;
            margin-left: .1rem;
            vertical-align: -1px;
        }
        .wb-hidden-trouble-num {
            color: #999999;
            font-size: .72rem;
        }
        .wb-text-defalut {
            color: #333;
        }
        .wb-hidden-trouble-num + .wb-hidden-trouble-num {
            margin-top: .05rem;
        }
        .aui-card-list .wb-flex.wb-space-between {
            padding-bottom: .45rem;
            border-bottom: 1px solid #ddd;
        }
        .aui-card-list .wb-flex.wb-space-between:last-child {
            padding-bottom: 0;
            border-bottom: 0;
        }
       .wb-notExaminedDele{
       		background-color:
       }
       .aui-btn-block {
			  width:16%;
			    height: 1.2rem;
			    line-height: 1.3rem;
			    margin-bottom: 0;
			    font-size: 0.7rem;
			    float:right;
			    margin-right:.2rem;
			}
		.header{
        	background-color:#ff961b;
        }
        [v-cloak] {
				display: none;
		}
		.defaultDiv-layout {
				margin-top: 35%;
				height: 100%;
				width: 100%;
				text-align: center;
			}

			.defaultDiv-layout label {
				color: #C4C4C4;
			}
			.defaultDiv {
				display: flex;
				justify-content: center;
				align-items: center;
				margin-bottom: 1rem;
			}

			.defaultDiv img {
				height: 5.5rem;
				width: 6rem;
			}

    </style>
</head>
<body>
    <!-- <div id="reportBtn" style="display: none;">
			<a href="#wheel" class="wheel-button " id="div1"><i class="xficon-add"></i></a>
			<ul id="wheel" class="wheel">
				<li class="item">
					<a href="javascript:;" onclick="goIn('by')">上报</br>保养</a>
				</li>
				<li class="item">
					<a href="javascript:;" onclick="goIn('wj')">上报</br>未检</a>
				</li>
				<li class="item">
					<a href="javascript:;" onclick="goIn('gz')">上报</br>故障</a>
				</li>
			</ul>
		</div> -->
    <section class="aui-content" id="app" v-cloak>
			<!--<header class="aui-bar aui-bar-nav header">
				<a class="aui-pull-left aui-btn">
					<span class="aui-iconfont aui-icon-left" onclick="back()"></span>
				</a>
				<div class="aui-title">未检明细 </div>

			</header>-->
			<!--<div class="filter"><b class="wbicon-filtrate"></b></div>-->
			<div class="aui-content-padded" v-if="completedData.length > 0">
				 <div class="aui-card-list" v-for="(item,index) in completedData">
	                <div class="aui-card-list-header">
	                    <h3 class="aui-ellipsis-1 wb-card-list-header">未检明细{{index+1}}</h3>
	                    <div v-if="planStatus == '2'" class="aui-btn aui-btn-danger aui-btn-block" @click="deleAjaxFun(item.id,index)">删除</div>
	                </div>
	                <div class="aui-card-list-content-padded">
	                    <div class="wb-card-list">
	                        <div class="wb-flex wb-flex-start">
	                            <h5 class="wb-card-title">系统类型：</h5>
	                            <span class="wb-info-text">{{item.checkItemTypeParentName}}</span>
	                        </div>
	                        <div class="wb-flex wb-flex-start wb-item-flexStart">
	                            <h5 class="wb-card-title">具体设备或区域：</h5>
	                            <span class="wb-info-text">{{item.uncheckedAddress}}</span>
	                        </div>
	                        <div class="wb-flex wb-flex-start wb-item-flexStart">
	                            <h5 class="wb-card-title" style="">未检原因：</h5>
	                            <span class="wb-info-text">{{item.uncheckedCause}}</span>
	                        </div>
	                        <div class="wb-flex wb-flex-start wb-item-flexStart">
	                            <h5 class="wb-card-title">补充说明：</h5>
	                            <span class="wb-info-text">{{item.description}}</span>
	                        </div>
	                    </div>
	                </div>
	            </div>
				<div class='noshuju' style="text-align:center;color:#999999; display:none">没有数据啦</div>
				<div class='to_load' style="text-align:center;color:#999999;display:none">加载更多...</div>
			</div>
			<div class="routineDefaultImg" v-if="defaultDiv != ''">
				<div class='defaultDiv-layout'>
					<div class='defaultDiv'><img :src='defaultDiv' /></div>
					<label style="">暂无未检记录</label>
				</div>
			</div>
		</section>
</body>
	<script type="text/javascript" src="../../script/api.js"></script>
	<script type="text/javascript" src="../../config/config.js"></script>
	<script type="text/javascript" src="../../script/vue.js"></script>
	<script type="text/javascript" src="../../script/mint-ui.js"></script>
	<script type="text/javascript" src="../../script/zepto.js"></script>
	<script type="text/javascript" src="../../script/mobileSelect.js"></script>
	<script type="text/javascript" src="../../script/umeng/zhuge.js"></script>
	<script type="text/javascript" src="../../script/jquery-1.7.2.min.js"></script>
	<script type="text/javascript" src="../../script/jquery.wheelmenu.js"></script>
	<!-- <script type="text/javascript" src="../../script/suspension.js"></script> -->
<script type="text/javascript">
   //����һ��������ֹ�ظ�����ajax
		var preventAjaxRepeatSubmit = true;
		var pageNo = 1;
		var pageVue;
		var paramObj = JSON.parse(localStorage.getItem('userObj'));
		var UIDatePicker,pageParam;
		apiready = function() {
//			pageParam = api.pageParam;
			// if(api.pageParam.planStatus == "2"){
			// 	$("#reportBtn").show()
			// }
			apiEvents();
			pageVue = new Vue({
				el: '#app',
				data: function() {
					return {
						completedData: [],
						pageSize:10,
						pageNo:1,
						planStatus:api.pageParam.planStatus,
						planId:api.pageParam.planId,
						proprietorName:api.pageParam.proprietorName,
						defaultDiv: "",
					}
				},
				created: function() {
					this.initData()
				},
				methods: {
					clickItem: function(item) {
						// 点击例行维保进详情
						api.openWin({
							name: 'routine/win_allList.html',
							url: './routine/win_allList.html',
							rect: {
								x: 0,
								y: 0,
								w: 320,
								h: 480
							},
							pageParam: item,
							bounces: false,
							bgColor: 'rgba(0,0,0,0)',
							vScrollBarEnabled: true,
							hScrollBarEnabled: true
						});
					},
					initData: function() {
						if(preventAjaxRepeatSubmit){
							preventAjaxRepeatSubmit = false;
							this.ajaxFun("first")
						}
						//请求后台方法

					},
					ajaxFun: function(str) {
						Vue.$indicator.open("加载中...");
						var that = this,pageNo = this.pageNo,planId = this.planId;
						//请求后台
						var obj = JSON.parse(localStorage.getItem("userObj"));

						api.ajax({
							url: webapp_global.url + "/maintenancePlanProcess/getUncheckList",
							method: 'get',
							dataType: "json",
							data: {
								values: {
									maintenanceTaskId:planId,//"201812201746290049",
									pageNo: pageNo,
									pageSize: 10
								}
							}
						}, function(ret, err) {

							Vue.$indicator.close();
							api.refreshHeaderLoadDone();
							api.parseTapmode();
							preventAjaxRepeatSubmit = true;
							if(ret&&ret.data) {
								if(str !="first"){
									if(ret.data.list.length == 0) {
										$(".to_load").hide();
										$(".noshuju").show();
									} else {
										$(".to_load").show();
										$(".noshuju").hide();
										that.completedData = that.completedData.concat(ret.data.list);
									}
								}else{
									that.completedData = ret.data.list;
									if(!that.completedData) {
										return
									}
									if(that.completedData.length == 0) {
										that.defaultDiv = "../../image/defaultPage/noCheck.png";
									} else {
										that.defaultDiv = "";
									}
									if(ret.data.list.length > 9) {
										setTimeout(function() {
											$(".to_load").show();
										}, 500)
									} else {
										$(".to_load").hide();
									}
								}

							} else {
								var connectionType = api.connectionType;
								if(connectionType == "none") {
									that.defaultDiv = "../../image/defaultPage/detectionNetwork.png"
								}
							}
						})
					},
					deleAjaxFun(id,_index){
						var that = this;
						api.confirm({
						    title: '删除未检明细',
						    msg: '确定删除本条未检明细吗？'
						}, function(ret, err) {
						    var index = ret.buttonIndex;
						    if(index=="2"){
						    	api.ajax({
									url: webapp_global.url + "/maintenancePlanProcess/deleteUncheckDetailById",
									method: 'get',
									dataType: "json",
									data: {
										values: {
											id:id
										}
									}
								}, function(ret, err) {
									that.completedData.splice(_index, 1)
								})
						    }

						});

					}
				}

			})
		};

		// 跳转
		function goIn(type) {
			if($("#wheel").css("display") == 'block') {
				$("#div1").click()
			}
			var urls = '';
			if(type == 'gz') {

				urls = '_reportFault'
			} else if(type == 'wj') {
				//例行维保 点击进入上报未检

				urls = '_reportNotcheck'
			} else if(type == 'by') {
				//例行维保 点击进入上报保养

				urls = '_maintainInsert'
			}
			//跳转页面吧系统大类带过去
			var idArr = [];
			api.openWin({
				name: urls,
				url: './' + urls + '.html',
				pageParam: {
					planId: api.pageParam.planId,
					proprietorId: api.pageParam.proprietorId,
					checkItemTypeId: "",
					checkItemTypeParentId: "",
					checkItemTypeParentIdArr: api.pageParam.checkItemTypeParentIdArr
				},
				bounces: true
			});
		}
		function apiEvents() {
			// 下拉刷新。调用请求后台接口
			api.setRefreshHeaderInfo({
				visible: true,
				bgColor: '#ccc',
				textColor: '#fff',
				textDown: '下拉刷新...',
				textUp: '松开刷新...',
				showTime: true
			}, function(ret, err) {
				pageVue.pageNo = 1;
				$(".to_load").hide()
				$(".noshuju").hide();
				if(preventAjaxRepeatSubmit){
					preventAjaxRepeatSubmit = false;
					pageVue.ajaxFun('first');
				}

			});

			api.addEventListener({
				name: 'scrolltobottom',
				extra: {
					threshold: 0
				}
			}, function(ret, err) {
				pageVue.pageNo +=1;
				setTimeout(function() {
					pageVue.ajaxFun()
				}, 500)
			});

			var connectionType = api.connectionType;
			if(connectionType == "none") {
				api.toast({
					msg: '网络走丢了，请找回网络',
					duration: 2000,
					location: 'middle',
					global: true
				});
			}
			//�����豸�Ͽ�������¼����ַ�����
			api.addEventListener({
				name: 'offline'
			}, function(ret, err) {
				api.toast({
					msg: '网络走丢了，请找回网络',
					duration: 2000,
					location: 'middle',
					global: true
				});
			});
			//监听设备断开网络的事件，字符串类型
			api.addEventListener({
				name: 'online'
			}, function(ret, err) {
				api.toast({
					msg: '网络已经找回，请刷新页面',
					duration: 2000,
					location: 'middle',
					global: true
				});
			});
			//������ͼ
			api.addEventListener({
				name: 'updateRoutineList'
			}, function(ret, err) {
				pageVue.initData();
			});
			//ios右滑控制
      api.addEventListener({
        name:'swiperight'
      }, function(ret, err){
      });
		}

		function closeWin() {
			api.closeWin({});
		}
		//返回，关闭当前页，
		function back() {
			api.closeWin();
		}

</script>
</html>
