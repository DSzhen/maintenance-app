<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>误报记录</title>
		<link rel="stylesheet" href="../../css/api.css" />
		<link rel="stylesheet" href="../../css/aui.css" />
		<link rel="stylesheet" href="../../css/mint-ui.css" />
		<link rel="stylesheet" href="../../css/wbicon/style.css" />
		<style type="text/css">
			html,
			body {
				height: 100%;
				display: flex;
				display: -webkit-flex;
				display: -webkit-box;
				flex-flow: column;
				-webkit-flex-flow: column;
				-webkit-box-orient: vertical;
				background-color: #fff;
			}
			
			.header {
				height: 57px;
				width: 100%;
				display: block;
				line-height: 57px;
				padding-top: 11px;
				font-size: .8rem;
			}
			
			.top-menu {
				text-align: center;
				color: #fff;
				font-weight: bold;
			}
			/*按钮*/
			
			.backBtn {
				height: 40px;
				width: 35px;
				position: absolute;
				right: left;
				bottom: 0;
			}
			
			.backBtn::before {
				position: absolute;
				top: 1rem;
				left: .75rem;
				display: block;
				content: '';
				width: 10px;
				height: 10px;
				border-left: 1px solid;
				border-top: 1px solid;
				color: #fff;
				transform: rotate(-45deg);
			}
			
			.btn {
				height: 40px;
				width: 35px;
				position: absolute;
				right: 0;
				bottom: 0;
			}
			/*首页头部导航*/
			/*字体颜色*/
			
			.header.home>div.active {
				opacity: 1;
			}
			
			.header.home {
				background-color: #ff961b;
			}
			
			.header.home .top-menu>div {
				color: #fff;
				opacity: .8;
			}
			
			.header.home .top-menu>div.active {
				opacity: 1;
			}
			
			.add_btn {
				-webkit-background-size: 38px 43px;
				background-size: 38px 43px;
			}
			
			.aui-content-padded {
				margin: .5rem 0;
				border-bottom: 1px solid #DFDFE5;
			}
			
			.wb-flex {
				display: -webkit-box;
				display: -webkit-flex;
				display: flex;
				-webkit-box-pack: justify;
				-webkit-justify-content: center;
				justify-content: center;
				-webkit-box-align: center;
				-webkit-align-items: center;
				align-items: center;
			}
			
			.wb-card-title {
				color: #999999;
				white-space: nowrap;
				vertical-align: top;
			}
			
			.wb-info-text{
				vertical-align: top;
			}
			
			.wb-update-img img {
				display: inline-block;
				width: 3rem;
				height: 3rem;
				margin-right: .4rem;
				border: 0;
				background-color: #e0e0e0;
			}
			
			.wb-application-icon {
				display: inline-block;
				position: absolute;
				left: 3rem;
				text-align: center;
				font-size: .9rem;
				z-index: 100;
			}
			
			.wb-flex-start {
				-webkit-justify-content: flex-start;
				justify-content: flex-start;
				align-items: flex-start;
			}
			.wb-item-time{
				color: #999999;
				position: absolute;
			}
			.wb-item-flexStart {
				-webkit-align-items: flex-start;
				align-items: flex-start;
			}
			
			.aui-card-list-content-padded {
				padding: 0.5rem 0.5rem;
			}
			
			.aui-card-list-content-padded .wb-flex+.wb-flex {
				margin-top: .4rem;
			}
			
			.wb-record-h5 {
				padding-bottom: .3rem;
				color: #ff961b;
			}
			
			.wb-text-primary {
				font-size: .6rem;
				margin-left: 4.45rem;
			}
			
			.wb-record-h5>span {
				margin-left: .1rem;
			}
			
			.wb-record-h5>span+span {
				margin-left: .2rem;
			}
			
			.wb-trouble-pos {
				font-size: .7rem;
				color: #454545;
				padding-left: 5.3rem;
				color: #999;
				/*white-space: nowrap;*/
			}
			
			.wb-trouble-pos~span {
				font-size: .7rem;
				color: #454545;
				margin-left: .5rem;
				color: #999;
			}
			
			.wb-disposition-list .wb-record-h5~div.wb-flex {
				margin-top: .2rem;
			}
			
			.wb-update-img img {
				display: inline-block;
				width: 3rem;
				height: 3rem;
				margin-right: .4rem;
				border: 0;
				background-color: #e0e0e0;
				border: 1px solid #e0e0e0;
			}
			
			.wb-disposition-list .wb-update-img {
				padding-left: 5.3rem;
				margin-top: .3rem;
			}
			
			.wb-disposition-ul {
				margin-top: .3rem;
			}
			
			.wb-disposition-ul li {
				position: relative;
				padding-bottom: .7rem;
			}
			
			.wb-disposition-ul li:before {
				position: absolute;
				top: .7rem;
				left: 4.7rem;
				content: '';
				width: 1px;
				height: 100%;
				border-left: 1px dashed #ff961b;
			}
			
			.wb-disposition-ul li:last-child:before {
				width: 0;
				height: 0;
				border-left: 0;
			}
		</style>
	</head>

	<body>
		<header id="header">
			<div class="header home active">
				<div class="backBtn" tapmode onclick="back()"></div>
				<div id="title" class="top-menu">设备误报记录</div>
			</div>
		</header>
		<div id="app" class="wb-content">
			<section class="aui-content-padded">
				<div class="aui-card-list-content-padded">
					<div class="wb-card-list">
						<div class="wb-flex wb-flex-start">
							<h5 class="wb-card-title">设&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;施：</h5>
							<span class="wb-info-text">{{deviceName}}</span>
						</div>
						<div class="wb-flex wb-flex-start">
							<h5 class="wb-card-title">位&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;置：</h5>
							<span class="wb-info-text">{{deviceAddress}}</span>
						</div>
						<div class="wb-flex wb-flex-start">
							<h5 class="wb-card-title">回路点位：</h5>
							<span class="wb-info-text">{{laLooplaPoint}}</span>
						</div>
					</div>
				</div>
			</section>
			<div class="aui-card-list-content-padded">
				<div class="wb-card-list wb-disposition-list">
					<ul class="wb-disposition-ul">
						<li v-for="temp in falseAlarmDescList">
							<div class="wb-item-time">
								<span>{{temp.issueTime.substring(0,10)}}</span><br />
								<span>{{temp.issueTime.substring(11)}}</span>
							</div>
							<h5 class="wb-record-h5">
                                <b class="wbicon-sure wb-text-primary"></b>
                                <span>{{temp.taketurn}}</span>
                            </h5>
							<div class="wb-flex wb-flex-start wb-item-flexStart">
								<a class="wb-trouble-pos" style="font-size: .7rem;color: #454545;">复原人员:</a>
								<span style="font-size: .7rem;color: #454545;">{{temp.issueUserName}}</span>
								<span style="font-size: .7rem;color: #454545;">{{temp.issueNamePhone}}</span>
							</div>
							<div class="wb-flex wb-flex-start wb-item-flexStart" style="flex-wrap:wrap；">
								<a class="wb-trouble-pos" style="font-size: .7rem;color: #454545;display:inline-block;width:100%;word-break: break-all;word-wrap:break-word;">{{temp.issueDesc}}</a>
							</div>
							<div class="wb-update-img" style="margin-top: .5rem">
								<img v-for="(src,index) in temp.attachList" :src="url + src.attachPath.substring(0,src.attachPath.length-4)+'_48X48'+src.attachPath.substring(src.attachPath.length-4,src.attachPath.length)" @click="openPicture(1,src,index,temp.attachList)">
							</div>
						</li>
					</ul>
				</div>
			</div>
		</div>
		<!--存放维保单号的处理信息-->
		<script type="text/javascript" src="../../script/api.js"></script>
		<script type="text/javascript" src="../../script/zepto.js"></script>
		<script type="text/javascript" src="../../script/vue.js"></script>
		<script type="text/javascript" src="../../config/config.js"></script>
		<script type="text/javascript" src="../../script/mint-ui.js"></script>
		<script type="text/javascript" src="../../script/iphoneX.js"></script>
		<script>
			var pageParam = {};
			apiready = function() {
				iphoneXfit();
				pageParam = api.pageParam;
				initEvents();
				//初始化页面数据
				initPage();
			}
//			pageParam = {"orderId":"201905162026204769","proprietorId":"AHHF_QHHFY_20180408","proprietorName":"清华大学合肥公共安全研究院","proprietorCoordinate":"1291458.11,1475585.55","submitter":"","submitTime":"2019-05-16 20:26:20","concat":"联系人","concatPhone":"12345678","orderTime":"","maintenanceState":"","memo":"","orderType":"","maintenanceDetails":{"accidentId":"","accidentNo":"","proprietorId":"","proprietorName":"","buildId":"AHHF_QHHFY_20180408_006","build":"学术报告厅","floorId":"AHHF_QHHFY_20180408_006_U002","floor":"2层","deviceId":"z_053","deviceName":"3-4号楼二层门厅烟感","deviceTypeId":"02060000","deviceType":"点型感烟探测器","deviceAddress":"1号消控主机烟感传感器_6号楼2层学术报告厅","deviceDescription":"","processState":"","reportUser":"","reportChannel":"","log":0,"lat":0,"attachment":"","troubleTime":"","list":[{"id":"","accidentId":"","attachName":"p-9462cff3.jpg","attachPath":"201905/16/201905161555421214.jpg","createTime":""}],"falseCount":"1天发生误报5次","flaseAttach":"","laLoop":"1","laMake":"1","laPoint":"6"},"maintenanceProcess":[{"maintenanceState":"1","time":"","concat":"","telephone":"","stateText":"已出发"},{"maintenanceState":"0","time":"2019-05-16 20:26:20","concat":"","telephone":"","stateText":"已提交"}],"falseOrderInfo":"","handleDetails":""} 
//			initPage();
			function initPage() {
				new Vue({
					el: "#app",
					data() {
						return {
							deviceName: pageParam.maintenanceDetails.deviceName,
							deviceAddress: pageParam.maintenanceDetails.deviceAddress,
							laLooplaPoint:pageParam.maintenanceDetails.laLoop+"-"+pageParam.maintenanceDetails.laPoint,
							falseAlarmDescList: [],
							url: webapp_global.imageUrl
						}
					},
					created() {
						this.initData();
					},
					methods: {
						//初始化数据
						initData() {
							var _this = this;
							Vue.$indicator.open("加载中...");
							api.ajax({
								url: webapp_global.url + "/maintenance/falseAlarmCount",
								method: 'get',
								dataType: "json",
								data: {
									values: {
										orderId: pageParam.orderId
									}
								}
							}, function(ret, err) {
								Vue.$indicator.close();
								if(ret && ret.data) {
									var data = ret.data;
									if(data.falseAlarmDescList && data.falseAlarmDescList.length > 0) {
										_this.falseAlarmDescList = data.falseAlarmDescList;
									} else {
										_this.falseAlarmDescList = [];
									}
								} else {}
							})
//							$.ajax({
//								type:"get",
//								url:webapp_global.url + "/maintenance/falseAlarmCount",
//								data:{
//									orderId: pageParam.orderId
//								},
//								success(ret){
////									Vue.$indicator.close();
//									if(ret && ret.data) {
//										var data = ret.data;
//										if(data.falseAlarmDescList && data.falseAlarmDescList.length > 0) {
//											_this.falseAlarmDescList = data.falseAlarmDescList;
//										} else {
//											_this.falseAlarmDescList = [];
//										}
//									} else {}
//								}
//							});
						},
						openPicture(flag, item, index, attaches) {
							//图片被点击了
							var paramObj = JSON.parse(localStorage.getItem('userObj'));
							var passObj = {
								"item": item,
								"index": index,
								"attaches": attaches,
								"flag": 0
							}
							api.openWin({
								name: 'picture',
								url: './picture.html',
								rect: {
									x: 0,
									y: 0,
									w: 320,
									h: 480
								},
								pageParam: passObj,
								bounces: true,
								bgColor: 'rgba(0,0,0,0)',
								vScrollBarEnabled: true,
								hScrollBarEnabled: true
							});
						},
					}
				})
			}

			function back() {
				api.closeWin();
			}

			function initEvents() {
				api.addEventListener({
					name: 'keyback'
				}, function(ret, err) {
					back();
				});
				//ios右滑控制
				api.addEventListener({
					name: 'swiperight'
				}, function(ret, err) {
					back()
				});
			}
		</script>
	</body>

</html>