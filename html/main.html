<!DOCTYPE HTML>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0, minimum-scale=1.0, user-scalable=0, initial-scale=1.0, width=device-width" />
		<meta name="format-detection" content="telephone=no, email=no, date=no, address=no">
		<title>首页</title>
		<link rel="stylesheet" type="text/css" href="../css/api.css" />
		<link rel="stylesheet" href="../css/aui.css" />
		<link rel="stylesheet" href="../css/aui-slide.css" />
		<link rel="stylesheet" href="../css/wbicon/style.css" />
		<style>
			html {
				font-family: "Microsoft YaHei";
			}

			body {
				background-color: #f6f6f6;
			}

			.wb-flex {
				display: -webkit-box;
				display: -webkit-flex;
				display: flex;
				-webkit-box-pack: justify;
				-webkit-justify-content: flex-start;
				justify-content: flex-start;
				-webkit-box-align: center;
				-webkit-align-items: center;
				align-items: center;
			}

			.wb-task-info--item {
				display: -webkit-box;
				display: -webkit-flex;
				display: flex;
				-webkit-box-pack: justify;
				-webkit-justify-content: space-between;
				justify-content: space-between;
				-webkit-box-align: center;
				-webkit-align-items: center;
				align-items: center;
			}

			.wb-task-info--start {
				-webkit-justify-content: flex-start;
				justify-content: flex-start;
			}

			.aui-background {
				background-color: #fff;
			}

			.aui-col-block {
				width: 3rem;
				height: 3rem;
				margin: 0 auto;
				margin-top: .5rem;
				text-align: center;
				line-height: 3rem;
				color: #fff;
				font-size: 1rem;
				border-radius: 1rem;
			}

			.aui-gird-lable {
				text-align: center;
				margin-top: .3rem;
				margin-bottom: .5rem;
			}

			.aui-border-r {
				border-right: 1px solid rgba(223, 223, 233, .4);
			}

			.aui-col-success {
				background-color: #71d5a5;
			}

			.aui-col-info {
				background-color: #5abff3;
			}

			.aui-col-danger {
				background-color: #ffcc02;
			}

			.aui-slide-node img {
				width: auto;
				height: 100%;
			}

			.aui-slide-m {
				margin-top: .4rem;
			}

			.aui-card-header {
				padding: .5rem .8rem;
			}

			.aui-card-header b {
				color: #333;
			}

			.aui-botton-border {
				border-bottom: 1px solid #ddd;
			}

			.wb-icon-image {
				width: 3rem;
				border-right: 1px solid #e9edf0;
			}

			.wb-icon-image img {
				width: 100%;
			}

			.aui-task-padded {
				padding: .5rem .8rem;
			}

			.wb-task-info--item {
				color: #525252;
				font-size: .75rem;
			}

			.wb-task-info--item+.wb-task-info--item {
				margin-top: .1rem;
			}

			.wb-task-info--item b {
				vertical-align: -1px;
			}

			.aui-slide-lx b {
				color: #50b1fc;
			}

			.aui-slide-emergency b {
				color: #f89647;
			}

			.wb-task-info {
				width: 83%;
			}

			.aui-slide-page-wrap {
				bottom: 0;
			}

			.wb-emergency-model {
				position: relative;
				margin: .5rem auto;
				height: 190px;
			}

			.wb-order-content {
				position: absolute;
				bottom: .1rem;
				left: 50%;
				text-align: center;
				transform: translateX(-50%);
			}

			.wb-order-content a {
				display: block;
				color: #2b9ada;
			}

			.wb-order-content a.wb-order-item:first-child {
				font-size: 1.6rem;
				font-weight: bold;
				line-height: 1;
			}

			.wb-emergency-unit {
				padding: 0 1rem;
				margin-bottom: .5rem;
				text-align: center;
				color: #2d96e9;
			}

			.aui-order-num {
				font-size: 1.4rem;
				line-height: .8;
				font-weight: bold;
				vertical-align: -2px;
			}

			.wb-emergency-unit .aui-order-radius {
				padding: .4rem 0 .3rem;
				margin-right: .1rem;
				background-color: rgba(44, 151, 230, .15);
				border-radius: .1rem;
			}

			.wb-emergency-unit .aui-col-xs-4:last-child .aui-order-radius {
				margin-right: 0;
			}

			.wb-task-inner-item {
				position: relative;
				display: block;
				padding: 0 .4rem;
				font-size: .7rem;
				color: #fd7575;
				background-color: rgba(253, 117, 117, .1);
				border-radius: .15rem;
				border: 1px solid #fd7575;
			}

			.wb-task-inner-item b {
				position: absolute;
				top: -.35rem;
				right: -.2rem;
				color: #fd7575;
			}

			.aui-month-content {
				padding-left: .5rem;
				padding-right: .5rem;
			}

			.wb-month-col {
				position: relative;
				padding: .8rem .3rem;
				text-align: center;
			}

			.aui-order-wb {
				position: absolute;
				top: 50%;
				left: 50%;
				transform: translate(-50%, -50%);
				width: 100%;
			}

			.aui-order-wbnum {
				font-size: 1rem;
				line-height: .9;
				font-weight: bold;
			}

			.aui-text-success {
				color: #1ead87;
			}

			.aui-text-info {
				color: #2d96e9;
			}

			.aui-text-warning {
				color: #f89647;
			}

			.aui-text-error {
				color: #f5849c;
			}

			[v-cloak] {
				display: none;
			}
		</style>
	</head>

	<body>
		<section class="aui-content">
			<div id="detectionNetwork">
				<div id="statisticalList" class="aui-background" v-cloak>
					<div class="aui-row">
						<div class="aui-col-xs-4 aui-border-r">
							<div class="aui-col-block aui-col-success">{{unitCount}}</div>
							<div class="aui-gird-lable aui-font-size-16">业主单位</div>
						</div>
						<div class="aui-col-xs-4 aui-border-r">
							<div class="aui-col-block aui-col-info">{{overdueCount}}</div>
							<div class="aui-gird-lable aui-font-size-16">已逾期</div>
						</div>
						<div class="aui-col-xs-4">
							<div class="aui-col-block aui-col-danger">--</div>
							<div class="aui-gird-lable aui-font-size-16">遗留故障</div>
						</div>
					</div>
				</div>

				<!--任务提醒-->
				<div class="wb-task-content aui-botton-border aui-slide-m aui-background">
					<div class="aui-card-header aui-botton-border"><b class="wbicon-horn aui-margin-r-5"></b>任务提醒</div>
					<!--轮播-->
					<div id="taskReminder" v-cloak>
						<div v-if="dataList.length>0" id="aui-slide">
							<div class="aui-slide-wrap">
								<!--应急维保-->
								<div class="aui-slide-node" v-for="item in dataList" v-if="item.type == 'emergency'">
									<div class="wb-flex aui-task-padded" @click="viewDetails(item)">
										<div class="wb-icon-image aui-padded-r-10"><img src="../image/index/wb-emergency.png"></div>
										<div class="wb-task-info aui-slide-emergency aui-padded-l-10">
											<div class="wb-task-info--item">
												<div class="wb-task-inner"><b class="wbicon-timer aui-margin-r-5"></b>{{item.time}}</div>
												<div class="wb-task-inner">
													<a v-if="item.isOverdue=='true'" class="wb-task-inner-item">逾期<b class="wbicon-time"></b></a>
												</div>
											</div>
											<div class="wb-task-info--item wb-task-info--start aui-ellipsis-1"><b class="wbicon-building aui-margin-r-5"></b>{{item.proprietorName}}</div>
										</div>
									</div>
								</div>
								<!--例行维保-->
								<div class="aui-slide-node" v-for="item in dataList" v-if="item.type == 'routine'">
									<div class="wb-flex aui-task-padded" @click="viewDetails(item)">
										<div class="wb-icon-image aui-padded-r-10"><img src="../image/index/wb-lx.png"></div>
										<div class="wb-task-info aui-slide-lx aui-padded-l-10">
											<div class="wb-task-info--item">
												<div class="wb-task-inner"><b class="wbicon-timeSolid aui-margin-r-5"></b>{{item.time}}</div>
												<div class="wb-task-inner">
													<a v-if="item.isOverdue=='true'" class="wb-task-inner-item">逾期<b class="wbicon-time"></b></a>
												</div>
											</div>
											<div class="wb-task-info--item wb-task-info--start aui-ellipsis-1"><b class="wbicon-buildSolid aui-margin-r-5"></b>{{item.proprietorName}}</div>
										</div>
									</div>
								</div>

							</div>
							<div class="aui-slide-page-wrap">
								<!--分页容器-->
							</div>
						</div>
						<div v-else>
							<div class="aui-slide-node">
								<div class="wb-flex aui-task-padded">
									<div class="wb-icon-image aui-padded-r-10"><img src="../image/index/wb-emergency.png"></div>
									<div class="wb-task-info aui-slide-emergency aui-padded-l-10">
										<div class="wb-task-info--item">
											<div class="wb-task-inner"><b class="wbicon-timer aui-margin-r-5"></b>无</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>

				<!--应急维保·今日-->
				<div id="emergencyCount" class="wb-emergency-content aui-botton-border aui-slide-m aui-background" v-cloak>
					<div class="aui-card-header aui-botton-border"><b class="wbicon-emergency aui-margin-r-5"></b>应急维保·<span>今日</span></div>
					<div class="wb-emergency-model">
						<div id="echarts-div" style="height:270px;width: 100%;"></div>
						<!--<img src="../image/index/wb-yb.png">
					<div class="wb-order-content">
						<a class="wb-order-item">{{wOrderCount}}</a>
						<a class="wb-order-item">今日订单</a>
					</div>-->
					</div>
					<div class="wb-emergency-unit">
						<div class="aui-row">
							<div class="aui-col-xs-4">
								<div class="aui-order-radius">
									<div class="aui-order-type aui-font-size-14">服务企业数<span class="aui-order-wbnum aui-margin-l-5">{{wUnitCount}}</span></div>
								</div>
							</div>
							<div class="aui-col-xs-4">
								<div class="aui-order-radius">
									<div class="aui-order-type aui-font-size-14">待处理订单<span class="aui-order-wbnum aui-margin-l-5">{{wDealCount}}</span></div>
								</div>
							</div>
							<div class="aui-col-xs-4">
								<div class="aui-order-radius">
									<div class="aui-order-type aui-font-size-14">已逾期订单<span class="aui-order-wbnum aui-margin-l-5">{{wOverdueCount}}</span></div>
								</div>
							</div>
						</div>
					</div>
				</div>

				<!--应急维保·本月-->
				<div id="planCount" class="wb-emergency-content aui-botton-border aui-slide-m aui-background" v-cloak>
					<div class="aui-card-header aui-botton-border"><b class="wbicon-setSolid aui-margin-r-5"></b>例行维保·<span>本月</span></div>
					<div class="aui-month-content">
						<div class="aui-row">
							<div class="aui-col-xs-3">
								<div class="wb-month-col">
									<img src="../image/index/circl-2.png">
									<div class="aui-order-wb aui-text-success">
										<div class="aui-order-wbnum">{{mCompletedCount}}</div>
										<div class="aui-font-size-12">已完成</div>
									</div>
								</div>
							</div>
							<div class="aui-col-xs-3">
								<div class="wb-month-col">
									<img src="../image/index/circl-1.png">
									<div class="aui-order-wb aui-text-info">
										<div class="aui-order-wbnum">{{mWaitCount}}</div>
										<div class="aui-font-size-12">待完成</div>
									</div>
								</div>
							</div>
							<div class="aui-col-xs-3">
								<div class="wb-month-col">
									<img src="../image/index/circl-3.png">
									<div class="aui-order-wb aui-text-warning">
										<div class="aui-order-wbnum">{{mOverdueCount}}</div>
										<div class="aui-font-size-12">已逾期</div>
									</div>
								</div>
							</div>
							<div class="aui-col-xs-3">
								<div class="wb-month-col">
									<img src="../image/index/circl-4.png">
									<div class="aui-order-wb aui-text-error">
										<div class="aui-order-wbnum">{{mLegacyFailureCount}}</div>
										<div class="aui-font-size-12">遗留故障</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>

	</body>
	<script type="text/javascript" src="../script/api.js"></script>
	<script type="text/javascript" src="../script/aui-slide.js"></script>
	<script type="text/javascript" src="../script/zepto.js"></script>
	<script type="text/javascript" src="../script/echarts.min.js"></script>
	<script type="text/javascript" src="../script/vue.js"></script>
	<script type="text/javascript" src="../script/umeng/zhuge.js"></script>

	<script src="../config/config.js"></script>
	<script type="text/javascript">
		var paramObj = JSON.parse(localStorage.getItem('userObj'));
		var statisticalListVue, taskReminderVue, emergencyCountVue, planCountVue, auiSlideObj;
		var iflyRecognition;
		var readNum = 1;
		var readList = [];
		//初始化页面展示数据
		apiready = function() {
			iflyRecognition = api.require('iflyRecognition');
			//统计首页
			initData();
			//监测时间
			apiEvents();
		}

		function initData() {
			//业主单位、已逾期、跟进任务
			_getStatisticalList();
			//获取任务提醒
			_getTaskReminder();
			//统计应急维保今日待服务企业、待处理订单、已逾期订单数
			_getEmergencyCount();
			//统计例行维保本月已完成、待完成、已逾期、遗留故障数
			_getPlanCount();
			setTimeout(function() {
				api.refreshHeaderLoadDone();
				api.parseTapmode();
			}, 1000)
		}
		//业主单位、已逾期、跟进任务
		function _getStatisticalList() {
			if(statisticalListVue) {
				statisticalListVue.initData()
			} else {
				statisticalListVue = new Vue({
					el: "#statisticalList",
					data: function() {
						return {
							unitCount: 0,
							FollowupTasks: 0,
							overdueCount: 0
						}
					},
					created: function() {
						this.initData();
					},
					methods: {
						initData: function() {
							var that = this;
							api.ajax({
								url: webapp_global.url + "/home/getStatisticalList",
								method: 'get',
								dataType: "json",
								data: {
									values: {
										userId: paramObj.userid,
									}
								}
							}, function(ret, err) {
								var code = ret["code"];
								if(code == "success") {
									var data = ret["data"];
									that.unitCount = data[0].unitCount
									that.FollowupTasks = data[0].FollowupTasks
									that.overdueCount = data[0].overdueCount
								}
							})
						}
					},
					mounted() {

					}
				})
			}
		}
		//获取任务提醒
		function _getTaskReminder() {
			if(taskReminderVue) {
				taskReminderVue.initData()
			} else {
				taskReminderVue = new Vue({
					el: "#taskReminder",
					data: function() {
						return {
							dataList: []
						}
					},
					created: function() {
						this.initData();
					},
					methods: {
						//初始化数据
						initData: function() {
							var that = this;
							api.ajax({
								url: webapp_global.url + "/home/getTaskReminder",
								method: 'get',
								dataType: "json",
								data: {
									values: {
										userId: paramObj.userid,
									}
								}
							}, function(ret, err) {
								var code = ret["code"];
								if(code == "success") {
									var data = ret["data"];
									if(data.length > 10) {
										data.length = 10;
									}
									taskReminderVue.dataList = data;
									//展示轮播图
									that.showAuiSlide();
								}
							})
						}, //展示轮播图
						showAuiSlide: function() {
							//是否重新初始化轮播
							taskReminderVue.$nextTick(function() {
								if(auiSlideObj) {
									auiSlideObj.destroy();
									auiSlideObj = undefined;
								};
								if(taskReminderVue.dataList.length > 0) {
									auiSlideObj = new auiSlide({
										container: document.getElementById("aui-slide"),
										// "width":300,
										"height": 260,
										"speed": 300,
										"autoPlay": 3000, //自动播放
										"pageShow": true,
										"pageStyle": 'dot',
										"loop": true,
										'dotPosition': 'center',
										currentPage: currentFun
									})
								}

								function currentFun(index) {}
							})
						},
						viewDetails: function(obj) {

							//GrowingIO 埋点
							console.log('在首页点击任务提醒')
							growingIoAddEvent('clickTaskReminder')

							if(obj.type == "emergency") {
								api.openWin({
									name: 'emergency/win_eme',
									url: './emergency/win_eme.html',
									rect: {
										x: 0,
										y: 0,
										w: 320,
										h: 480
									},
									pageParam: {
										orderId: obj.id,
										orderType: obj.orderType,
										gname: "main"
									},
									bounces: false,
									bgColor: 'rgba(0,0,0,0)',
									vScrollBarEnabled: true,
									hScrollBarEnabled: true
								});
							} else if(obj.type == "routine") {
								obj.gname = "main";
								api.ajax({
									url: webapp_global.url + "/maintenancePlanProcess/getPlanExistById",
									method: 'get',
									dataType: "json",
									data: {
										values: {
											planId: obj.id
										}
									}
								}, function(ret, err) {
									if(ret && ret["code"]) {
										var data = ret["data"];
										obj.planStatus = "1";
										obj.planId = obj.id;
										if(data.status == "1" || data.status == 1) {
											api.openWin({
												name: '_routineMaintenanceDetails',
												url: './newRoutine/_routineMaintenanceDetails.html',
												pageParam: obj
											});
										} else {
											api.toast({
												msg: '此条维保计划不在本月计划当中，不能查看详情！',
												duration: 4000,
												location: 'middle'
											});
										}
									}
								})
							}
						}
					},
					mounted() {}
				})
			}
		}
		//统计应急维保今日待服务企业、待处理订单、已逾期订单数
		function _getEmergencyCount() {
			if(emergencyCountVue) {
				emergencyCountVue.initData()
			} else {
				emergencyCountVue = new Vue({
					el: "#emergencyCount",
					data: function() {
						return {
							wOrderCount: 0,
							wUnitCount: 0,
							wDealCount: 0,
							wOverdueCount: 0,
						}
					},
					created: function() {
						this.initData();
					},
					methods: {
						initData: function() {
							var that = this;
							api.ajax({
								url: webapp_global.url + "/home/getEmergencyCount",
								method: 'get',
								dataType: "json",
								data: {
									values: {
										userId: paramObj.userid,
									}
								}
							}, function(ret, err) {
								var code = ret["code"];
								if(code == "success") {
									var data = ret["data"];
									that.wOrderCount = data[0].wOrderCount;
									that.wUnitCount = data[0].wUnitCount;
									that.wDealCount = data[0].wDealCount;
									that.wOverdueCount = data[0].wOverdueCount;
									//创建echarts图表
									_initEcharts("echarts-div", data[0].wOrderCount, data[0].wCompletedCount);
								}
							})
						}
					},
					mounted: function() {}
				})
			}
		}
		//统计例行维保本月已完成、待完成、已逾期、遗留故障数
		function _getPlanCount() {
			if(planCountVue) {
				planCountVue.initData();
			} else {
				planCountVue = new Vue({
					el: "#planCount",
					data: function() {
						return {
							mCompletedCount: 0,
							mWaitCount: 0,
							mOverdueCount: 0,
							mLegacyFailureCount: 0
						}
					},
					created: function() {
						this.initData();
					},
					methods: {
						initData: function() {
							var that = this;
							api.ajax({
								url: webapp_global.url + "/home/getPlanCount",
								method: 'get',
								dataType: "json",
								data: {
									values: {
										userId: paramObj.userid,
									}
								}
							}, function(ret, err) {
								var code = ret["code"];
								if(code == "success") {
									var data = ret["data"];
									that.mCompletedCount = data[0].mCompletedCount;
									that.mWaitCount = data[0].mWaitCount;
									that.mOverdueCount = data[0].mOverdueCount;
									that.mLegacyFailureCount = data[0].mLegacyFailureCount;
								}
							})
						}
					},
					mounted: function() {}
				})
			}
		}
		//初始化echarts图表
		function _initEcharts(divId, count, wCompletedCount) {
			var splitNumber = 0.01;
			if(count != 0) {
				splitNumber = count;
			}
			option = {
				series: [{
					name: '今日订单',
					type: 'gauge',
					detail: {
						formatter: '今日订单',
						textStyle: {
							fontSize: 17
						}
					},
					title: {
						textStyle: {
							fontWeight: 'bolder',
							fontSize: 20,
							fontStyle: 'italic',
							color: '#03a9f4',
							shadowColor: '#03a9f4', //默认透明
							shadowBlur: 10
						}
					},
					data: [{
						value: wCompletedCount,
						name: count + ""
					}],
					max: splitNumber,
					splitNumber: splitNumber,
					startAngle: 180,
					endAngle: 0,
					axisLine: {
						show: true,
						lineStyle: {
							color: [
								[wCompletedCount / count || 0, '#48ace6'],
								[1, '#3c8dbc']
							],
							width: 20
						}
					}
				}]
			};
			var myChart = echarts.init(document.getElementById(divId));
			myChart.setOption(option);
		}
		//消息推送代码全
		var tempDialogObj;
		//新订单播报
		function dialog_message(obj) {
			// 发送监听到消息提醒列表页
			api.sendEvent({
				name: 'sendNotications'
			});
			// obj.type ==	"1", "火警"
			// obj.type == "211", "新应急维保订单"
			// obj.type == "212", "应急维保订单改派"
			// obj.type =="222", "维保计划改派"
			// obj.type =="223", "已下发计划删除"
			// obj.type =="31", "服务关系绑定提醒"
			// obj.type =="32", "服务关系解除提醒"
			if(obj.type == '1' || obj.type == '211' || obj.type == '221') {
				show_center(obj);
				if(readNum == 1) {
					//读完继续走
					readList.push(obj);
					to_to()
				} else {
					//没读完，放到list
					readList.push(obj);
				}
			} else {
				show_top(obj)
			}
		}
		// 去播报
		function to_to() {
			readNum = 0;
			iflyRecognition.createUtility({
				ios_appid:iflyRecognitionIdIos,
				android_appid: iflyRecognitionId // 填写讯飞平台上获得的appid
			}, function(ret, err) {
				if(ret.status) {} else {}
			});
			if(readList.length > 0) {
				iflyRecognition.createUtility({
					ios_appid:iflyRecognitionIdIos,
					android_appid: iflyRecognitionId // 填写讯飞平台上获得的appid
				}, function(ret, err) {
					if(ret.status) {} else {}
				});
				var readStr_ = '';
				if(readList[0].type == '211') {
					readStr_ = '您有新的应急维保订单。'
				} else if(readList[0].type == '221') {
					readStr_ = '您有新的例行维保任务。'
				} else {
					readStr_ = readList[0].content
				}
				iflyRecognition.read({
					readStr: readStr_,
					speed: 60,
					volume: 60,
					rate: 16000,
					audioPath: 'fs://speechRecogniser/read.mp3'
				}, function(ret, err) {
					if(ret.status) {
						if(ret.speakProgress == 100) {
							readNum = 1;
							readList.splice(0, 1);
							to_to()
						}
					} else {
						api.alert({
							msg: err.msg
						});
					}
				});
			} else {
				readNum = 1;
			}
		}
		// 弹出顶部弹窗的推送
		function show_top(obj) {
			var y = 2
			if (api.systemType == 'ios') {
        		if (api.deviceModel == 'iPhone10,3') {
        			y = 43
        		}
        	}
			api.openFrame({
				name: 'open_top.html',
				url: './open_top.html',
				pageParam: obj,
				rect: {
					y: y,
					x: 0,
					// w: api.winWidth -20,
					w: 'auto',
					h: 80
				},
				bounces: false,
				reload: true,
				// bgColor: 'rgba(0,0,0,0)',
				vScrollBarEnabled: false,
				hScrollBarEnabled: false
			});
		}

		// 弹出中间弹窗的推送
		function show_center(obj) {
			api.sendEvent({
				name: 'dialogMessageBobao',
				extra: {
					pageParam: obj
				}
			});
			api.openFrame({
				name: 'open.html_' + obj.id,
				url: './open.html',
				pageParam: obj,
				animation: {
					type: "movein",
					subType: "from_right",
					duration: 300
				},
				rect: {
					x: 0,
					y: 0,
					w: 'auto',
					h: 'auto'
				},
				bounces: false,
				bgColor: 'rgba(0,0,0,0)',
				vScrollBarEnabled: true,
				hScrollBarEnabled: true
			});
		}

		//关闭弹框
		function closeIconFun() {
			$('#showMessageId').remove();
		}
		//查看新消息详情
		function showMessage() {
			var obj = tempDialogObj;
			$('#showMessageId').remove();
			if(obj.type == 0) {
				api.openWin({
					name: 'win_eme.html',
					url: './emergency/win_eme.html',
					rect: {
						x: 0,
						y: 0,
						w: 320,
						h: 480
					},
					pageParam: obj,
					bounces: true,
					bgColor: 'rgba(0,0,0,0)',
					vScrollBarEnabled: true,
					hScrollBarEnabled: true
				});
			}
		}

		function apiEvents() {
//ios右滑控制
      api.addEventListener({
        name:'swiperight'
      }, function(ret, err){
      });
			// 下拉刷新。调用请求后台接口
			api.setRefreshHeaderInfo({
				visible: true,
				bgColor: '#ccc',
				textColor: '#fff',
				textDown: '下拉刷新...',
				textUp: '松开刷新...',
				showTime: true
			}, function(ret, err) {
				initData()
			});

			api.addEventListener({
				name: 'pageLoadingData'
			}, function(ret, err) {
				initData();
			});

			//			api.setRefreshHeaderInfo({
			//				visible: true,
			//				bgColor: '#ccc',
			//				textColor: '#fff',
			//				textDown: '下拉刷新...',
			//				textUp: '松开刷新...',
			//				showTime: true
			//			}, function(ret, err) {
			//				initData();
			//			});

			var connectionType = api.connectionType;
			if(connectionType == "none") {
				api.toast({
					msg: '网络走丢了，请找回网络',
					duration: 2000,
					location: 'middle',
					global: true
				});
			}
			//监听设备断开网络的事件，字符串类型
			api.addEventListener({
				name: 'offline'
			}, function(ret, err) {
				api.toast({
					msg: '网络走丢了，请找回网络',
					duration: 2000,
					location: 'middle',
					global: true
				});
			});
			//监听设备连接到网络的事件，字符串类型
			api.addEventListener({
				name: 'online'
			}, function(ret, err) {
				api.toast({
					msg: '网络已经找回，请刷新页面',
					duration: 2000,
					location: 'middle',
					global: true
				});
			});
		}
	</script>

</html>
